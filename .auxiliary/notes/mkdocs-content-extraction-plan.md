# MkDocs Content Extraction Implementation Plan

## Investigation Summary

### Target Sites Analysis
- **Pydantic docs**: Material for MkDocs with mkdocstrings, 1742 search documents, 1066 inventory objects
- **FastAPI docs**: Material for MkDocs with mkdocstrings, 2667 search documents, 1349 inventory objects  
- **mkdocstrings docs**: Material for MkDocs with mkdocstrings, 519 search documents, 539 inventory objects

### Key Findings

**Dual Data Sources Available:**
1. **Sphinx Inventories** (`objects.inv`) - Provided by mkdocstrings integration
   - Standard Python domains (`py`) with roles (class, function, module, attr, data)
   - Direct URI mapping to documentation pages with anchors
   - Structured metadata for API objects

2. **Search Indices** (`search/search_index.json`) - Generated by Material for MkDocs
   - Full-text searchable content with preprocessing pipelines
   - Document structure with location/title/text fields
   - Language and separator configuration

**Content Architecture:**
- Material for MkDocs provides consistent HTML structure patterns
- mkdocstrings generates API documentation following predictable conventions
- JavaScript-based client-side search with worker files
- Responsive themes with standardized CSS selectors

### Current Implementation Gap
The existing MkDocs processor only implements detection and basic theme identification. The `extract_contents` method in `structures/mkdocs/detection.py` returns an empty list with a TODO comment.

## Implementation Strategy

### Phase 1: Content Extraction Infrastructure
Implement the core `extract_contents` functionality by adapting the proven Sphinx extraction approach for Material for MkDocs themes.

**Architecture Pattern:**
- Mirror `structures/sphinx/extraction.py` design
- Create theme-specific extraction patterns for Material for MkDocs
- Leverage existing inventory integration through mkdocstrings

### Phase 2: Theme-Specific Extraction Patterns
Develop extraction patterns targeting Material for MkDocs theme structures:

**Content Types to Handle:**
1. **API Documentation Sections** - Generated by mkdocstrings
   - Class definitions with method listings
   - Function signatures with parameter documentation
   - Module overviews with member listings
   - Attribute and data documentation

2. **Article Content** - Standard Material theme structure
   - Main content containers
   - Section headers and navigation
   - Code examples and syntax highlighting
   - Admonitions and callout boxes

3. **Navigation Context** - Theme-specific elements
   - Breadcrumb trails for context
   - Section hierarchies
   - Cross-references and internal links

### Phase 3: Content Processing Pipeline
Implement robust content extraction and cleaning:

**Processing Steps:**
1. **URL Resolution** - Use inventory URIs to locate target pages
2. **HTML Retrieval** - Fetch documentation pages with caching
3. **Content Identification** - Locate specific elements using anchors
4. **Theme-Aware Extraction** - Apply Material-specific patterns
5. **Content Cleaning** - Remove navigation elements and formatting artifacts
6. **Markdown Conversion** - Transform to consistent output format

### Phase 4: Integration with Inventory System
Leverage the dual data approach for comprehensive coverage:

**Inventory-Guided Extraction:**
- Use inventory objects to identify documentation targets
- Map inventory URIs to specific page sections
- Extract both API signatures and descriptive content
- Provide fallback strategies for missing or relocated content

**Search Index Augmentation:**
- Cross-reference with search index for additional context
- Identify content patterns and document structures
- Validate extraction completeness against indexed content

## Technical Implementation Approach

### Module Structure
Follow existing patterns in `sources/librovore/structures/`:
- Extend `mkdocs/detection.py` with content extraction implementation
- Create `mkdocs/extraction.py` for theme-specific logic
- Add `mkdocs/patterns.py` for Material theme extraction rules

### Extraction Pattern Design
Implement DSL-based extraction similar to Sphinx themes:
- Define Material theme content strategies
- Support multiple Material theme variants
- Provide generic fallback patterns for unknown configurations
- Handle responsive design and dynamic content

### Error Handling and Robustness
Ensure graceful degradation:
- Handle missing or relocated content
- Manage network timeouts and access errors
- Provide meaningful fallback content when extraction fails
- Log diagnostic information for troubleshooting

### Testing Strategy
Validate against real-world sites:
- Test with Pydantic, FastAPI, and mkdocstrings documentation
- Verify content quality and completeness
- Ensure consistent extraction across different page types
- Monitor performance and caching effectiveness

## Success Criteria

### Functional Requirements
1. **Content Extraction** - Successfully extract API documentation from mkdocstrings-generated sites
2. **Theme Compatibility** - Support Material for MkDocs and common variants
3. **Inventory Integration** - Leverage Sphinx inventories for target identification
4. **Quality Output** - Provide clean, formatted content suitable for search and analysis

### Performance Requirements
1. **Efficient Caching** - Minimize redundant HTTP requests
2. **Parallel Processing** - Handle multiple object extraction concurrently
3. **Resource Management** - Respect robots.txt and implement appropriate delays
4. **Error Recovery** - Graceful handling of inaccessible or malformed content

### Integration Requirements
1. **MCP Compatibility** - Work seamlessly with existing MCP server architecture
2. **CLI Integration** - Support command-line query operations
3. **Extension Framework** - Follow librovore's dual processor architecture
4. **Configuration** - Allow customization of extraction patterns and behaviors

## Implementation Priority
Focus on high-value, commonly-used documentation patterns first:
1. Python API documentation (classes, functions, methods)
2. Material theme standard article content
3. Code examples and syntax highlighting
4. Cross-references and internal navigation

This approach maximizes immediate utility while establishing the foundation for broader MkDocs ecosystem support.