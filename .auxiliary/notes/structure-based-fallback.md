# Structure-Based Content Extraction Fallback

## Concept Overview

A potential future enhancement to provide fallback content extraction when inventory-guided methods are insufficient or fail. This would complement the existing single-source fallback with structure-based semantic analysis.

## Motivation

While the current inventory-guided extraction with single-source fallback handles most cases well, there are scenarios where additional extraction methods could be valuable:

- **Sparse inventory coverage**: Sites with limited or incomplete inventory objects
- **Content extraction failures**: When inventory-guided extraction returns insufficient content
- **Dynamic content**: Documentation generated by JavaScript or other dynamic methods
- **Non-standard documentation**: Sites that don't follow typical documentation patterns

## Proposed Architecture

### Hybrid Extraction Strategy

```python
async def extract_with_hybrid_fallback(
    self, auxdata, source, objects
) -> tuple[ContentDocument, ...]:
    """Combine inventory-guided extraction with structure-based fallback."""

    # Phase 1: Primary inventory-guided extraction (current approach)
    primary_results = await self.extract_contents(objects)

    # Phase 2: Quality assessment
    failed_objects = identify_insufficient_extractions(objects, primary_results)

    # Phase 3: Structure-based fallback for insufficient results
    if failed_objects:
        fallback_results = await self.extract_content_structure_based(failed_objects)
        primary_results = merge_extraction_results(primary_results, fallback_results)

    return primary_results
```

### Structure-Based Extraction Methods

1. **Semantic HTML Analysis**: Extract content from semantic markup (headings, sections, articles)
2. **Text Density Analysis**: Identify content-rich areas vs navigation/boilerplate
3. **DOM Tree Analysis**: Find documentation-specific patterns in HTML structure
4. **Template Detection**: Identify and extract from common documentation templates

### Quality Assessment Criteria

Determine when fallback extraction is needed:
- **Empty or minimal content**: Primary extraction returned very little text
- **Missing key elements**: No signatures, descriptions, or code examples found
- **Structure inconsistencies**: Content doesn't match expected documentation patterns
- **User feedback**: Historical data showing poor extraction quality

## Implementation Considerations

### Performance Impact
- Only activate fallback when primary extraction is insufficient
- Cache structure analysis results to avoid repeated computation
- Set reasonable timeouts for fallback extraction attempts

### Quality Control
- Fallback results should be clearly marked as such
- Provide confidence scores for different extraction methods
- Allow users to understand which extraction method was used

### Backward Compatibility
- Fallback extraction is purely additive - never replaces working primary extraction
- Default behavior remains unchanged for sites where primary extraction works well
- Graceful degradation if fallback methods fail

## Future Development Path

### Phase 1: Research and Prototyping
- Analyze sites where current extraction is insufficient
- Prototype structure-based extraction algorithms
- Develop quality assessment metrics

### Phase 2: Selective Implementation
- Implement fallback for specific documented failure cases
- A/B test against current extraction quality
- Collect user feedback on extraction improvements

### Phase 3: General Deployment
- Deploy fallback system with conservative activation criteria
- Monitor performance and quality impact
- Refine activation criteria based on real-world usage

## Current Status

**DEFERRED** - Not needed for current implementation goals.

The existing inventory-guided extraction with single-source fallback provides excellent coverage and quality for the vast majority of documentation sites. This enhancement should be considered only after:

1. Real-world usage identifies specific gaps in extraction quality
2. User feedback indicates need for additional extraction methods
3. Performance analysis shows the additional complexity is justified

The restructuring phases (1-4) have successfully achieved the core goals of improved coverage and maintainability. This fallback concept remains available for future enhancement when usage patterns demonstrate its value.